<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../../../js/mui.min.js"></script>
		<script src="../../../js/ServerIP.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../js/jquery-2.2.1.js" type="text/javascript" charset="utf-8"></script>
		<link href="../../../css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: true
			});
			//本地所有学生数据
			var allStudents = {};
			//获取到的评分
			var resultStarScore = {};
		</script>
		<style type="text/css">
			.mui-content {
				margin-top: 0px;
			}
		</style>
		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">课堂</h1>
		</header>
		<div class="mui-content">
			<div>
				<ul id="namelist" class="mui-table-view">
					<!--这里为填充的内容-->
				</ul>
			</div>

		</div>

	</body>
	<script>
		mui.plusReady(function() {
			
			var allstu = localStorage.stuNameList; //重新转换为对象 
			allStudents = JSON.parse(allstu);
			if (allStudents.length != 0) {
				creatNamePan();
				console.log("创建列表");
			}

			function creatNamePan() {
				$("#namelist").empty();
				var title = "<li class='mui-table-view-divider'>课堂表现</li>";
				$("#namelist").append(title);
				for (var i = 0; i < allStudents.length; i++) {
					var username = allStudents[i]['username'];
					var stuId = allStudents[i]["stuId"];
					var starScore = 0;
					//判断是否存在对象 不存在就不操作
					if (notEmptyObject(resultStarScore)) {
						for (var a = 0; a < resultStarScore.length; a++) {
							if (resultStarScore[a]["stuId"] == stuId) {
								starScore = resultStarScore[a]['starscore'];
							}
						}
					}
					var nameslistPan = "<li class='mui-table-view-cell'>" + username + "<span class='mui-badge mui-badge-primary'>" + starScore + "分</span></li>";
					$("#namelist").append(nameslistPan);
				}
			};
			mui.ajax(serverIp + "/teacher/getStarScore", {
				data: {},
				dataType: 'json',
				type: 'post',
				timeout: 5000,
				success: function(data) {
					if (data['code'] == 200) {
						resultStarScore = data['starScore'];
						creatNamePan();
					} else {
						mui.toast("获取评分失败");
					}
				},
				error: function() {
					mui.toast("获取评分失败error");
				}
			});
		});
		//判断空对象
		function notEmptyObject(obj) {
			for (var name in obj) {
				return true;
			}
			return false;
		}
	</script>

</html>