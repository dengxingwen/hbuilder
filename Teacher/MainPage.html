<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="../js/ServerIP.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/jquery-2.2.1.js" type="text/javascript" charset="utf-8"></script>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="UTF-8">
			mui.init();
		</script>
		<style type="text/css">
			.mui-content {
				margin-top: 0px;
			}
			
			#selectpan {
				margin-top: 10px;
			}
			
			#randomBackView {
				position: relative;
				margin-top: 0px;
				/*background-color: #ADADAD;*/
				padding-top: 15px;
				height: 230px;
			}
			
			.wrapper {
				padding: 10px;
				width: 100%;
				background-color: ghostwhite;
				height: 120px;
				font: 14px/1.5 arial;
				text-align: center;
				position: relative;
				background: url(../images-rong/bg_foot.min.png) no-repeat scroll 50% 0;
				/*margin: 10px auto;*/
			}
			/*tab*/
			
			#randomnamebutton {
				width: 60%;
				height: 45px;
				position: absolute;
				bottom: 10px;
				left: 50%;
				margin-left: -30%;
			}
			
			#star {
				overflow: hidden;
				padding: 4px 0;
			}
			
			#star li {
				float: left;
				width: 20%;
				height: 30px;
				margin: 0px;
				display: inline;
				color: #999;
				font: bold 18px arial;
				cursor: pointer
			}
			
			#star .act {
				color: dodgerblue;
			}
			
			#star_word {
				width: 80%;
				height: 30px;
				line-height: 30px;
				position: absolute;
				left: 50%;
				text-align: center;
				display: none;
			}
		</style>

		<style type="text/css">
			.mui-icon-star {
				color: #B5B5B5;
				font-size: 30px;
			}
			
			.mui-icon-star-filled {
				color: #FFB400;
				font-size: 30px;
			}
			
			ul {
				padding: 10px 0px;
			}
			
			li {
				display: -webkit-box;
				width: 100%;
				padding: 0 10px;
			}
			
			li div {
				-webkit-box-flex: 2;
				text-align: center;
			}
			
			i {
				width: 18%;
			}
		</style>
		<script type="text/javascript">
			//按钮状态
			var start = true;
			var idd;
			//停止时学生姓名
			var stopName;
			//停止时学号
			var stopStuId;
			//五星评分
			var starScore = 0;
			//定义变量 
			var allStuInfo = {};
			allStuInfo = JSON.parse(localStorage.stuNameList);
		</script>
		<!--<script>
			function Star() {
				var star = document.getElementById("star");
				var star_li = star.getElementsByTagName("i");
				var star_word = document.getElementById("star_word");
				var result = document.getElementById("result");
				var i = 0;
				var j = 0;
				var len = star_li.length;
				var word = ['1分', '2分', '3分', "4分", "5分"]
				for (i = 0; i < len; i++) {
					star_li[i].index = i;
					star_li[i].onclick = function() {
						//result.innerHTML = (this.index + 1) + "分";
						//star_word.style.display = "block";
						//star_word.innerHTML = word[this.index];
						
//						for (i = 0; i < len; i++) {
//							star_li[i].className = "";
//						}
//						for (i = 0; i <= this.index; i++) {
//							star_li[i].className = "act";
//						}
						//starScore = this.index + 1;
						//console.log("分数为：" + starScore);
					}
				}
			}
		</script>-->
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: dodgerblue;">
			<a id="addclassseting" class="mui-icon mui-icon-gear mui-pull-right" style="color: white;"></a>
			<h1 id="title" class="mui-title" style="color: white;">首页</h1>
		</header>
		<div class="mui-content">

			<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
					<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/yuantiao.jpg">
							<p class="mui-slider-title">静静看这世界</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/shuijiao.jpg">
							<p class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/muwu.jpg">
							<p class="mui-slider-title">想要一间这样的木屋，静静的喝咖啡</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/cbd.jpg">
							<p class="mui-slider-title">Color of SIP CBD</p>
						</a>
					</div>
					<div class="mui-slider-item">
						<a href="#">
							<img src="../images/yuantiao.jpg">
							<p class="mui-slider-title">静静看这世界</p>
						</a>
					</div>
					<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../images/shuijiao.jpg">
							<p class="mui-slider-title">幸福就是可以一起睡觉</p>
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator mui-text-right">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
				</div>
			</div>

			<!--
                	作者：张敏
                	时间：2016-02-16
                	描述：用来显示姓名
                -->

			<div id="randomBackView" align="center">
				<div id="showNameText" style="font-size:20px; color:dodgerblue;text-align: center;height: 30px;"></div>
				<div class="wrapper">
					<div id="star" class="icons" align="center">
						<!--<i data-index="1" class="mui-icon mui-icon-star"></i>
						<i data-index="2" class="mui-icon mui-icon-star"></i>
						<i data-index="3" class="mui-icon mui-icon-star"></i>
						<i data-index="4" class="mui-icon mui-icon-star"></i>
						<i data-index="5" class="mui-icon mui-icon-star"></i>-->
					</div>
					<!--<ul id="star">-->
						<!--<li>★</li>
						<li>★</li>
						<li>★</li>
						<li>★</li>
						<li>★</li>-->

					<!--</ul>-->

					<div id="randomDiv" style="position: relative;width: 100%;margin-top: 48px;">
						<!--	<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined" style="width:70px;height:35px;position: absolute;bottom: 0px;left: 50%;margin-left:-35px;">提交</button>--></div>
				</div>

				<div style="width: 100%;margin-top: 5px;position: absolute;bottom:0;">
					<button id="randomnamebutton" type="button" class="mui-btn mui-btn-primary">随机点名</button>
				</div>
			</div>
			

		</div>
	</body>
	<script type="text/javascript">
		//随机点名
		function showName() {
			var index = Math.floor(Math.random() * allStuInfo.length);
			var name = allStuInfo[index]["username"];
			//document.getElementById("showNameText").innerHTML = name;
			document.getElementById("showNameText2").innerHTML = name;
			stopName = name;
			stopStuId = allStuInfo[index]["stuId"];
			idd = setTimeout("showName()", 8);
		}
		mui.plusReady(function() {
			var slider = mui("#slider");

			function slidepic() {
				slider.slider({
					interval: 3000
				});
			};
			slidepic();
			//
			//处理右上角关于图标的点击事件；
			document.getElementById('addclassseting').addEventListener('tap', function() {
				console.log("设置班级");
				mui.openWindow({
					url: "SettingClass.html",
					id: "info",
					show: {
						aniShow: 'zoom-fade-out',
						duration: 300
					}
				});
			});
			//提交五星评分
			mui('#randomDiv').on('tap', 'button', function() {
				mui.ajax(serverIp + "/teacher/getStarScore", {
					data: {
						stuId: stopStuId,
						starScore: starScore
					},
					dataType: 'json',
					type: 'post',
					timeout: 4000,
					success: function(data) {
						console.log("评分上传成功");
						console.log(data['code']);
						if (data['code'] == 200) {
							mui.toast("评价成功")
						} else {
							console.log("400");
							mui.toast("评价失败");
						}
					},
					error: function() {
						console.log("error");
						mui.toast("评价失败 error!");
					}
				});
			});
			//随机点名
			document.getElementById("randomnamebutton").addEventListener('tap', function() {
				console.log("随机点名");
				if (start) {
					//先清空评分div
					emptyStarView();
					showName();
					randomnamebutton.innerHTML = "停止";
					start = false;
				} else {
					//呈现评分div
					displayStarView();
					clearTimeout(idd);
					randomnamebutton.innerHTML = "随机点名";
					start = true;
				}
			});
			//
			mui('.icons').on('click', 'i', function() {
				var index = parseInt(this.getAttribute("data-index")); //获取当前元素的索引值
				
				var parent = this.parentNode; //获取当前元素的父节点
				var children = parent.children; //获取父节点下所有子元素
				if (this.classList.contains("mui-icon-star")) { //判断当前节点列表中是否含有.mui-icon-star元素
					for (var i = 0; i < index; i++) { //亮星
						children[i].classList.remove('mui-icon-star');
						children[i].classList.add('mui-icon-star-filled');
					}
				} else { //重置已经亮星的元素
					for (var i = index; i < 5; i++) {
						children[i].classList.add('mui-icon-star')
						children[i].classList.remove('mui-icon-star-filled')
					}
				}
				
				starScore = index;
				console.log(starScore);
				console.log(stopStuId);
				//document.getElementById("info").innerHTML = parent.previousElementSibling.innerText + "：" + index + "星好评";
			});
		});
		//点名后呈现评分界面
		function emptyStarView() {
			$("#star").empty();
			$("#randomDiv").empty();
			var strStar = "<div id='showNameText2' style='font-size:20px; color:dodgerblue;text-align: center;height: 30px;'></div>";
			$("#star").append(strStar);
			document.getElementById("showNameText").innerHTML = "";
			console.log("测试清空是否执行");
		};

		function displayStarView() {
			$("#star").empty();
			var strStar = "<li>★</li><li>★</li><li>★</li><li>★</li><li>★</li>";
			var strStar2 = "<i data-index='1' class='mui-icon mui-icon-star'></i><i data-index='2' class='mui-icon mui-icon-star'></i><i data-index='3' class='mui-icon mui-icon-star'></i><i data-index='4' class='mui-icon mui-icon-star'></i><i data-index='5' class='mui-icon mui-icon-star'></i>";
			$("#star").append(strStar2);
			$("#randomDiv").empty();
			var randomStr = "<button id='submitStarScore' type='button' class='mui-btn mui-btn-primary mui-btn-outlined' style='width:70px;height:35px;position: absolute;bottom: 0px;left: 50%;margin-left:-35px;'>提交</button>";
			$("#randomDiv").append(randomStr);
			//Star();
			document.getElementById("showNameText").innerHTML = stopName;
			console.log("测试显示是否执行");
		};
	</script>

</html>